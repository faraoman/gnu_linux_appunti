<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><link rel="preconnect" href="https://www.google-analytics.com/"><link rel="preconnect" href="https://matomo.jonlu.ca/"><link rel="amphtml" href="https://blog.jonlu.ca/amp/posts/spf-dkim"><meta name="author" content="JonLuca DeCaro"><meta content="Email authentication: SPF, DKIM and DMARC out in the wild" name="title"><meta content="Email authentication: SPF, DKIM and DMARC out in the wild" name="og:title"><title>Email authentication: SPF, DKIM and DMARC out in the wild - JonLuca's Blog</title><meta property="og:image" content="https://blog.jonlu.ca/images/SPF.png"><meta property="image" content="https://blog.jonlu.ca/images/SPF.png"><meta name="og:email" content="hi@jonlu.ca"><link rel="apple-touch-icon" sizes="180x180" href="https://blog.jonlu.ca/fav/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://blog.jonlu.ca/fav/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://blog.jonlu.ca/fav/favicon-16x16.png"><link rel="manifest" href="https://blog.jonlu.ca/fav/site.webmanifest"><link rel="mask-icon" href="https://blog.jonlu.ca/fav/safari-pinned-tab.svg" color="#5bbad5"><link rel="shortcut icon" href="https://blog.jonlu.ca/fav/favicon.ico"><meta name="msapplication-TileColor" content="#00aba9"><meta name="msapplication-TileImage" content="/fav/mstile-144x144.png"><meta name="msapplication-config" content="/fav/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link type="application/atom+xml" rel="alternate" href="https://blog.jonlu.ca/feed.xml" title="JonLuca's Blog"><title>Email authentication: SPF, DKIM and DMARC out in the wild | JonLuca’s Blog</title><meta name="generator" content="Jekyll v3.8.6"><meta property="og:title" content="Email authentication: SPF, DKIM and DMARC out in the wild"><meta property="og:locale" content="en_US"><meta name="description" content="JonLuca’s Blog - A blog about tech, programming, and information"><meta property="og:description" content="JonLuca’s Blog - A blog about tech, programming, and information"><link rel="canonical" href="https://blog.jonlu.ca/posts/spf-dkim"><meta property="og:url" content="https://blog.jonlu.ca/posts/spf-dkim"><meta property="og:site_name" content="JonLuca’s Blog"><meta property="og:type" content="article"><meta property="article:published_time" content="2019-11-29T18:26:11-08:00"><script type="text/javascript" async="" src="Email%20authentication%20%20SPF,%20DKIM%20and%20DMARC%20out%20in%20the%20wild%20-%20JonLuca's%20Blog_files/analytics.js"></script><script type="text/javascript" async="" defer="defer" src="Email%20authentication%20%20SPF,%20DKIM%20and%20DMARC%20out%20in%20the%20wild%20-%20JonLuca's%20Blog_files/a.js"></script><script type="application/ld+json">{"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.jonlu.ca/posts/spf-dkim"},"@type":"BlogPosting","url":"https://blog.jonlu.ca/posts/spf-dkim","headline":"Email authentication: SPF, DKIM and DMARC out in the wild","dateModified":"2019-11-29T18:26:11-08:00","datePublished":"2019-11-29T18:26:11-08:00","description":"JonLuca’s Blog - A blog about tech, programming, and information","@context":"https://schema.org"}</script><meta content="width=device-width,initial-scale=1,maximum-scale=12,minimum-scale=.25,user-scalable=yes" name="viewport"><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="Email%20authentication%20%20SPF,%20DKIM%20and%20DMARC%20out%20in%20the%20wild%20-%20JonLuca's%20Blog_files/style.css"><style type="text/css">/* Chart.js */
@keyframes chartjs-render-animation{from{opacity:.99}to{opacity:1}}.chartjs-render-monitor{animation:chartjs-render-animation 1ms}.chartjs-size-monitor,.chartjs-size-monitor-expand,.chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}.chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}.chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}</style><link rel="prefetch"></head><body class="lh-copy dark-gray pa0 f6 sans-serif bg-super-white"><header class="tc mt4"><p>JonLuca's Blog</p></header><div class="width bg-white mt4 mb3 center br2-ns bt bb ba-ns b--light-gray"><nav aria-label="Main" class="bb b--light-gray pv4 tc"><a class="link blue mh2 pv1" href="https://blog.jonlu.ca/">Posts </a><a class="link blue mh2 pv1" href="https://blog.jonlu.ca/about">About </a><a class="link blue mh2 pv1" href="https://blog.jonlu.ca/contact">Contact</a></nav><main class="tl f6 relative pa4 pa5-ns overflow-hidden"><div class="mb4"><div class="fw600 light-silver mt1">29 Nov 2019</div><h1 class="ttu f3 mt0 lh-title cb mb2">Email authentication: SPF, DKIM and DMARC out in the wild</h1></div><div class="markdown-body"><div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div><div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div><div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div><div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div><script src="Email%20authentication%20%20SPF,%20DKIM%20and%20DMARC%20out%20in%20the%20wild%20-%20JonLuca's%20Blog_files/Chart.js" integrity="sha256-xKeoJ50pzbUGkpQxDYHD7o7hxe0LaOGeguUidbq6vis=" crossorigin="anonymous" type="text/javascript"></script><p>Email
 authentication has had a turbulent history - SMTP did not have a native
 form of authentication when it was designed, and all modern 
authentication methods are built on top of that system. This was not a 
problem in the 1980s because there were simply too few people emailing -
 the only ones using it were universities and corporations actively 
involved in building the internet. Since then we’ve got a variety of 
tools to attempt to verify emails, including SPF, DKIM, and DMARC, and I
 wanted to explore the actual usage of these authentication methods by 
the most popular sites and companies in the world - specifically, the 
top 100 domains retrieved from Alexa and the Fortune 500 companies.</p><h2 id="authentication-methods">Authentication methods</h2><p>There
 are three generally accepted email authentication methods - SPF, DKIM, 
and DMARC. They are all set through DNS, and hinge on proof of domain 
ownership. If ownership of a domain is lost, the majority of email 
security is lost as well.</p><h3 id="spf">SPF</h3><p>SPF, or <strong>Sender Policy Framework</strong>,
 is a protocol that allows the owner of a domain to specify which mail 
servers they’ll be sending mail from. When another email provider 
receives an email, they perform an SPF check, which entails verifying 
that the sender is an allowed sender based on the rule sets of the 
sending domain.</p><p>The receiving server compares the IP address of 
the sending MTA (Message Transfer Agent) with the allowed IPs from the 
SPF record. The are a few results that can occur, but the most common 
are <code class="highlighter-rouge">accept</code>, <code class="highlighter-rouge">reject</code>, and <code class="highlighter-rouge">accept but mark</code> (soft fail).</p><picture class="centered-image"><source srcset="/images/SPF.webp" type="image/webp"><source srcset="/images/SPF.png" type="image/png"><img alt="SPF diagram" class="centered-image" src="Email%20authentication%20%20SPF,%20DKIM%20and%20DMARC%20out%20in%20the%20wild%20-%20JonLuca's%20Blog_files/SPF.png"></picture><p class="footnote">SPF in action (credit to https://postmarkapp.com/guides/spf)</p><p>Note
 that an SPF failure doesn’t mean that the message is immediately 
discarded - most of the time an SPF failure is a good signal that the 
mail is bad, but it’s not a guarantee. Companies will rotate IPs or 
domains often enough that it can’t be an end all be all security check.</p><h4 id="how-it-works">How it works</h4><p>SPF for a domain is set up through a <code class="highlighter-rouge">TXT</code> DNS record. All spf records start with <code class="highlighter-rouge">v=spf1</code>, and then are followed by a list of allowed IPs (or domains). These IPs are retrieved using various mechanisms, outlined below.</p><div class="table100 tableTop ver1 m-b-110"><table data-vertable="ver1"><thead><tr class="row100 head"><th class="column100 column1" data-column="column1">Mechanism</th><th class="column100 column1" data-column="column1">How it works</th></tr></thead><tbody><tr class="row100"><td class="column100 column1" data-column="column1">all</td><td class="column100 column1" data-column="column1">All IPs fall under this qualification (should always be last in the record)</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">ip4:ip</td><td class="column100 column1" data-column="column1">An IPv4 address, or subnet</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">ip6:ip</td><td class="column100 column1" data-column="column1">An IPv6 address, or subnet</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">a:domain</td><td class="column100 column1" data-column="column1">All the A records for the domain are tested. If the domain is not specified, the current domain is used.</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">mx:domain</td><td class="column100 column1" data-column="column1">All the A records for all the MX records for the domain are tested. If the domain is not specified, the current domain is used.</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">ptr:domain</td><td class="column100 column1" data-column="column1">The
 hostname for the client IP are looked up using a PTR query. At least 
one of the A records for a PTR hostname must match the original client 
IP.</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">exists:domain</td><td class="column100 column1" data-column="column1">If the domain does not resolve, the result is fail. If it does resolve, this results in a match (and pass).</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">include:domain</td><td class="column100 column1" data-column="column1">The specified domain is searched for a match</td></tr></tbody></table></div><p>Each of these mechanisms is prefixed by a qualifier. If there is no qualifier specified, <code class="highlighter-rouge">+</code> is the default (pass).</p><div class="table100 tableTop ver1 m-b-110"><table data-vertable="ver1"><thead><tr class="row100 head"><th class="column100 column1" data-column="column1">Qualifier</th><th class="column100 column1" data-column="column1">Result</th></tr></thead><tbody><tr class="row100"><td class="column100 column1" data-column="column1" style="font-size:28px">+</td><td class="column100 column1" data-column="column1">Pass (default)</td></tr><tr class="row100"><td class="column100 column1" data-column="column1" style="font-size:28px">-</td><td class="column100 column1" data-column="column1">Fail</td></tr><tr class="row100"><td class="column100 column1" data-column="column1" style="font-size:28px">~</td><td class="column100 column1" data-column="column1">SoftFail</td></tr><tr class="row100"><td class="column100 column1" data-column="column1" style="font-size:28px">?</td><td class="column100 column1" data-column="column1">Neutral</td></tr></tbody></table></div><p>So for instance, a sample SPF record might look like:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>v=spf1 ip4:35.190.247.0/24 ip4:216.239.32.0/19 ~all
</code></pre></div></div><p>This says that it should pass any IP in either the <code class="highlighter-rouge">35.190.247.0/24</code> or <code class="highlighter-rouge">216.239.32.0/19</code> range, and soft fail all others.</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>v=spf1 ip4:66.3.159.0/24 include:mail.zendesk.com include:_spf.google.com -all
</code></pre></div></div><p>This says that it should pass any IP in the <code class="highlighter-rouge">66.3.159.0/24</code> range, include all valid domains for <code class="highlighter-rouge">mail.zendesk.com</code> and <code class="highlighter-rouge">_spf.google.com</code> and fail all others.</p><p>I won’t delve too deep into the SPF specification - <a href="https://tools.ietf.org/html/rfc7208" target="_blank" rel="noopener noreferrer">if you’d like to know more you can read the RFC</a>.</p><h2 id="spf-in-the-wild">SPF in the wild</h2><p>I
 wanted to see how many domains set up SPF and rely on it, and 
specifically how many of them have too permissive rule sets (either a <code class="highlighter-rouge">+all</code> or a <code class="highlighter-rouge">~all</code>).</p><p>I used the <code class="highlighter-rouge">checkdmarc</code> <a href="https://pypi.org/project/checkdmarc/" target="_blank" rel="noopener noreferrer">python package</a> to query the Top 100 domains and the domains of the Fortune 500 companies.</p><h3 id="top-100-domains">Top 100 Domains</h3><p>For the top 100 domains, <em>50</em> of them have <code class="highlighter-rouge">all</code> set to softfail, whose intended action is <code class="highlighter-rouge">accept but mark</code>
 - this effectively says that any email received from a non-designated 
sender should be accepted but “marked” (which has no specific action 
associated - some providers drop the email, others send to junk, and 
others send to inbox).</p><canvas id="topDomainsSpf" width="1092" height="545" style="display: block; width: 783px; height: 391px;" class="chartjs-render-monitor"></canvas><p>The “(INCLUDE)” above means that the SPF record also has an <code class="highlighter-rouge">include:domain</code> in it, which might include an explicit, more restrictive<code class="highlighter-rouge">all</code> directive. However, due to the way that SPF works, all you need to do is pass one mechanism to be considered a <code class="highlighter-rouge">pass</code> - so a softfail will still be counted as a <code class="highlighter-rouge">softfail</code>, even if there is a <code class="highlighter-rouge">fail</code> later on (due to <code class="highlighter-rouge">-all</code>).</p><p>Additionally, 4 out of the 100 actually had invalid or no SPF records.</p><div class="table100 tableTop ver1 m-b-110"><table data-vertable="ver1"><thead><tr class="row100 head"><th class="column100 column1" data-column="column1">Domain</th><th class="column100 column1" data-column="column1">Failure</th></tr></thead><tbody><tr class="row100"><td class="column100 column1" data-column="column1">businessinsider.com</td><td class="column100 column1" data-column="column1"><code>v=spf1 include:_spf.googlemail.com include:mail.zendesk.com include:aspmx.pardot.com -all</code><br><br>The domain _spf.googlemail.com does not exist</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">go.com</td><td class="column100 column1" data-column="column1">go.com has no SPF record</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">office.com</td><td class="column100 column1" data-column="column1">office.com has no SPF record</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">apartments.com</td><td class="column100 column1" data-column="column1"><code>v=spf1
 ip4:66.231.92.15 ip4:50.28.24.60 ip4:65.222.181.0/24 
ip4:204.253.48.0/24 ip4:65.210.23.128/25 ip4:65.222.180.0/24 
include:salesforce.com include:s._spf.pardot.com ~all</code><br><br>The domain s._spf.pardot.com does not exist</td></tr></tbody></table></div><p>Specifically, go.com and office.com have no SPF records, meaning that any email originating from an <code class="highlighter-rouge">@go.com</code> or <code class="highlighter-rouge">@office.com</code> can’t be verified.</p><h3 id="fortune-500-domains">Fortune 500 Domains</h3><p>For the domains of the Fortune 500 companies, <em>250</em> of them have <code class="highlighter-rouge">all</code> set to softfail.</p><canvas id="fortuneSpf" width="1092" height="545" style="display: block; width: 783px; height: 391px;" class="chartjs-render-monitor"></canvas><p>Only 419 have valid SPF tags, although the majority of invalid tags are due to non-resolvable includes and missing SPF records.</p><p>50
 of the Fortune 500 companies have no SPF record at all set for the main
 domain. This is slightly misleading, as some of their main domains are 
pure redirects (for instance, Hilton’s main domain is <code class="highlighter-rouge">hiltonworldwide.com</code>, which actually redirects to <code class="highlighter-rouge">hilton.com</code>. However, SPF does not respect redirects, and as such any email from <code class="highlighter-rouge">@hiltonworldwide.com</code> will not be able to be marked as a <code class="highlighter-rouge">fail</code>.</p><p>The
 only one of note to have an actually malformed SPF tag is 
huntingtoningalls.com, a military shipbuilding company, which has an 
infinite redirect (the SPF entry for <code class="highlighter-rouge">huntingtoningalls.com</code> has <code class="highlighter-rouge">include:huntingtoningalls.com</code> in it).</p><h2 id="dkim">DKIM</h2><p>If SPF is just concerned with the sender of the message, DKIM, or <strong>DomainKeys Identified Mail</strong> also cares about certain parts of the actual contents of the message. The following description is courtesy of <a href="https://en.wikipedia.org/wiki/Email_authentication" target="_blank" rel="noopener noreferrer">Wikipedia</a>.</p><blockquote><p>A
 DKIM-compliant domain administrator generates one or more pairs of 
asymmetric keys, then hands private keys to the signing MTA, and 
publishes public keys on the DNS. The DNS labels are structured as <code class="highlighter-rouge">selector._domainkey.example.com</code>,
 where selector identifies the key pair, and _domainkey is a fixed 
keyword, followed by the signing domain’s name so that publication 
occurs under the authority of that domain’s ADMD. Just before injecting a
 message into the SMTP transport system, the signing MTA creates a 
digital signature that covers selected fields of the header and the body
 (or just its beginning). The signature should cover substantive header 
fields such as From:, To:, Date:, and Subject:, and then is added to the
 message header itself, as a trace field. Any number of relays can 
receive and forward the message and at every hop, the signature can be 
verified by retrieving the public key from the DNS.[</p></blockquote><p>Unfortunately
 due to the way that DKIM is implemented there is no easy way to detect 
if a domain is using DKIM. You have to know the selector a specific 
domain uses, and that exploration is outside the scope of this blog 
post.</p><h2 id="dmarc">DMARC</h2><p>DMARC, or <strong>Domain-based Message Authentication, Reporting and Conformance</strong>,
 actually extends SPF and DKIM. It allows the owner of a domain to 
publish a policy in their DNS records to specify which mechanism (DKIM, 
SPF or both) is employed when sending email from that domain; how to 
check the <code class="highlighter-rouge">From:</code> field presented 
to end users; how the receiver should deal with failures - and a 
reporting mechanism for actions performed under those policies.</p><p>DMARC
 introduces a concept called alignment, which has to do with the match 
of the top level domain and “Organization Domain”. Under DMARC a message
 can fail even if it passes SPF or DKIM, but fails alignment. The 
following description and example is courtesy of <a href="https://en.wikipedia.org/wiki/DMARC" target="_blank" rel="noopener noreferrer">Wikipedia</a>.</p><blockquote><p>Alignment
 may be specified as strict or relaxed. For strict alignment, the domain
 names must be identical. For relaxed alignment, the top-level 
“Organizational Domain” must match. The Organizational Domain is found 
by checking a list of public DNS suffixes, and adding the next DNS 
label. So, for example, “a.b.c.d.example.com.au” and “example.com.au” 
have the same Organizational Domain, because there is a registrar that 
offers names in “.com.au” to customers. Albeit at the time of DMARC spec
 there was an IETF working group on domain boundaries, nowadays the 
organizational domain can only be derived from the Public Suffix List.</p></blockquote><p>DMARC
 records are published in DNS with a subdomain label _dmarc, for example
 _dmarc.example.com. Compare this to SPF at example.com, and DKIM at 
selector._domainkey.example.com.</p><p>The content of the TXT resource record consists of <code class="highlighter-rouge">name=value</code> tags, separated by semicolons, similar to SPF and DKIM. For example:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"v=DMARC1;p=none;sp=quarantine;pct=100;rua=mailto:dmarcreports@example.com;"
</code></pre></div></div><p>Here, <code class="highlighter-rouge">v</code> is the version, <code class="highlighter-rouge">p</code> is the policy, <code class="highlighter-rouge">sp</code> the subdomain policy, <code class="highlighter-rouge">pct</code> is the percent of DMARC failures that should be reported to the owner of the domain, and <code class="highlighter-rouge">rua</code>
 is the URI to send aggregate reports to. In this example, the entity 
controlling the example.com DNS domain intends to monitor SPF and/or 
DKIM failure rates and doesn’t expect emails to be sent from subdomains 
of example.com. Note that a subdomain can publish its own DMARC record; 
receivers must check it out before falling back to the organizational 
domain record.</p><picture class="centered-image"><source srcset="/images/dmarc-policy.webp" type="image/webp"><source srcset="/images/dmarc-policy.png" type="image/png"><img alt="DMARC policy diagram" class="centered-image" src="Email%20authentication%20%20SPF,%20DKIM%20and%20DMARC%20out%20in%20the%20wild%20-%20JonLuca's%20Blog_files/dmarc-policy.png"></picture><p class="footnote">DMARC in action (credit to https://campus.barracuda.com/product/sentinel/doc/78157593/configuring-spf-dkim-and-dmarc/)</p><h3 id="name-types">Name types</h3><p>The DMARC specification provides three options for domain owners to say how they want failed emails to be treated. These <code class="highlighter-rouge">p=</code> policies are:</p><div class="table100 tableTop ver1 m-b-110"><table data-vertable="ver1"><thead><tr class="row100 head"><th class="column100 column1" data-column="column1">Value</th><th class="column100 column1" data-column="column1">Result</th></tr></thead><tbody><tr class="row100"><td class="column100 column1" data-column="column1">none</td><td class="column100 column1" data-column="column1">Treat the mail the same as it would be without any DMARC validation</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">quarantine</td><td class="column100 column1" data-column="column1">Accept but do not send to inbox</td></tr><tr class="row100"><td class="column100 column1" data-column="column1">reject</td><td class="column100 column1" data-column="column1">Do not accept the message at all</td></tr></tbody></table></div><p>The only required tags are <code class="highlighter-rouge">v</code> and <code class="highlighter-rouge">p</code>. There are quite a few other optional tags, but the only ones we’ll be concerned with are <code class="highlighter-rouge">sp</code>, <code class="highlighter-rouge">adkim</code>, and <code class="highlighter-rouge">aspf</code>.</p><p>The <code class="highlighter-rouge">sp=</code> specifies the intended behavior around authentication failures for subdomains - for instance, <code class="highlighter-rouge">mail.example.com</code> can fail and the DMARC entry for <code class="highlighter-rouge">example.com</code>
 will specify the intended behavior for that subdomain. Note that 
subdomains can also have their own DMARC policies (in the example above,
 at <code class="highlighter-rouge">_dmarc.mail.example.com</code>). The policy options are the same as the “p” tag listed above.</p><p><code class="highlighter-rouge">adkim</code>
 indicates strict or relaxed DKIM identifier alignment. The default is 
relaxed, which means that only the root domain needs to match. <code class="highlighter-rouge">aspf</code> indicates strict or relaxed SPF identifier alignment. The default is also relaxed.</p><h3 id="top-100-domains-1">Top 100 Domains</h3><p>Of the top 100, only 74 of them have DMARC policies set up.</p><canvas id="topDomainsDmarc" width="1092" height="545" style="display: block; width: 783px; height: 391px;" class="chartjs-render-monitor"></canvas><p>27 of them have their policy set to <code class="highlighter-rouge">none</code>
 - this doesn’t necessarily mean to accept the email, as it can still 
fail the SPF check, but it does indicate that, even on a DMARC failure, 
the receiver should do nothing.</p><p>Only 2 of the top 100 domains have strict <code class="highlighter-rouge">adkim</code> or <code class="highlighter-rouge">aspf</code> policies - mayoclinic.org and retailmenot.com.</p><h3 id="fortune-500-domains-1">Fortune 500 Domains</h3><p>Of the fortune 500, only 329 of them have DMARC policies set up, or a 66% implementation rate.</p><canvas id="fortuneDmarc" width="1092" height="545" style="display: block; width: 783px; height: 391px;" class="chartjs-render-monitor"></canvas><p>74 of them have their policy set to <code class="highlighter-rouge">none</code>.</p><p>Even more amazingly, only <strong>one</strong> domain has their <code class="highlighter-rouge">adkim</code> or <code class="highlighter-rouge">aspf</code> policy set to strict! That domain is pmi.com, or Philip Morris International.</p><h2 id="dnssec-in-the-wild">DNSSEC in the wild</h2><p>While
 doing this research I also got whether the domain was using DNSSEC. 
While not strictly related to email authentication, it does provide a 
stronger level of trust for the results of a DNS query, which is what 
all the email authentication above is based on.</p><p>For the Top 100 sites, only 6 of them are using DNSSEC (a <strong>6%</strong> implementation rate). For the Fortune 500, it’s even worse, at 14, or a <strong>2.8%</strong> implementation rate.</p><h2 id="what-does-this-mean">What does this mean?</h2><p>I
 was fairly surprised at the low adoption rates for the various security
 features above. If I had to guess it’s because of the haphazard nature 
of email systems growth. When there wasn’t one standardized security 
methodology from the beginning, each system will slowly build out its 
own, becoming a frankenstein monster of proprietary software and 
incorrectly implemented standards.</p><p>It doesn’t mean that the 
domains above that aren’t implementing SPF or DKIM are vulnerable to 
attack - there are still other ways to prove authentication, including 
more sophisticated algorithms used by the big players (looking at you 
Gmail and Outlook). Enterprises often have their own rulesets inside 
their network which will prevent phishing emails from reaching their 
targets based on the originating MTA regardless of any SPF failures. It 
does mean, however, that everyone has to “roll their own” layer of email
 authentication security, whether that means relying on a third party 
like Google or purchasing other outside software.</p><p>Email spam and 
phishing are still a problem due to there not being a perfect solution, 
and it looks like it will remain that way for quite a while.</p><h2 id="conclusion">Conclusion</h2><p>The
 ramifications of not building authentication and security into your 
protocol when it’s designed can be far reaching. This isn’t to blame the
 creators of SMTP or email - no one knew how big it would get when it 
was originally designed. However, it’s not hard to imagine a world with 
significantly less spam and email attacks, where the attack surface is 
much smaller due to a well designed, cryptographically secure 
authentication system. Even today, the most popular sites visited by 
billions of people a day are using patches and half baked solutions, and
 fall prey to these attacks on a daily basis. Even the official 
solutions listed above have pretty bad adoption rates among some of the 
largest sites and companies in the world.</p><p><a href="https://github.com/jonluca/SPF-Research" target="_blank" rel="noopener noreferrer">The code and all the data can be found on GitHub in the SPF-Research repo.</a></p><script type="text/javascript">const options = {
    scales: {
      yAxes: [{
        ticks: {
          beginAtZero: true
        }
      }]
    }
  };
  const ctx = document.getElementById('topDomainsSpf').getContext('2d');
  const topDomainsSpf = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['SoftFail (INCLUDE)', 'Fail (INCLUDE)', 'Neutral', 'Fail', 'Neutral (INCLUDE)', 'SoftFail'],
      datasets: [{
        label: '# of Domains',
        data: [47, 26, 8, 7, 5, 3],
        backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)'],
        borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)'],
        borderWidth: 1
      }]
    },
    options: options
  });

  const ctx2 = document.getElementById('fortuneSpf').getContext('2d');
  const fortuneSpf = new Chart(ctx2, {
    type: 'bar',
    data: {
      labels: ['SoftFail (INCLUDE)', 'Fail (INCLUDE)', 'SoftFail', 'Fail', 'Neutral (INCLUDE)', 'Neutral'],
      datasets: [{
        label: '# of Domains',
        data: [228, 134, 22, 15, 13, 7],
        backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)'],
        borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)'],
        borderWidth: 1
      }]
    },
    options: options
  });

  const ctx3 = document.getElementById('topDomainsDmarc').getContext('2d');
  const topDomainsDmarc = new Chart(ctx3, {
    type: 'bar',
    data: {
      labels: ['reject', 'none', 'quarantine'],
      datasets: [{
        label: '# of Domains',
        data: [40, 27, 7],
        backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)'],
        borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)'],
        borderWidth: 1
      }]
    },
    options: options
  });
  const ctx4 = document.getElementById('fortuneDmarc').getContext('2d');
  const fortuneDmarc = new Chart(ctx4, {
    type: 'bar',
    data: {
      labels: ['reject', 'none', 'quarantine'],
      datasets: [{
        label: '# of Domains',
        data: [222, 74, 33],
        backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)'],
        borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)'],
        borderWidth: 1
      }]
    },
    options: options
  });</script></div><p class="mt4">JonLuca <span class="silver">at 18:26</span></p><div><style>.twt-btn-o{max-width:100%}.twt-btn{position:relative;text-decoration:none;height:20px;box-sizing:border-box;padding:1px 8px 1px 6px;background-color:#1b95e0;color:#fff;border-radius:3px;font-weight:500;cursor:pointer}.rtl .twt-btn{padding:1px 6px 1px 8px;text-decoration:none}.twt-btn:active,.twt-btn:focus,.twt-btn:hover{background-color:#0c7abf}.twt-btn:active{box-shadow:inset 0 3px 5px rgba(0,0,0,.1)}.xl .twt-btn:active{box-shadow:inset 0 3px 7px rgba(0,0,0,.1)}.twt-btn i{position:relative;top:2px;display:inline-block;width:14px;height:14px;text-decoration:none;background:transparent 0 0 no-repeat;background-image:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2072%2072%22%3E%3Cpath%20fill%3D%22none%22%20d%3D%22M0%200h72v72H0z%22%2F%3E%3Cpath%20class%3D%22icon%22%20fill%3D%22%23fff%22%20d%3D%22M68.812%2015.14c-2.348%201.04-4.87%201.744-7.52%202.06%202.704-1.62%204.78-4.186%205.757-7.243-2.53%201.5-5.33%202.592-8.314%203.176C56.35%2010.59%2052.948%209%2049.182%209c-7.23%200-13.092%205.86-13.092%2013.093%200%201.026.118%202.02.338%202.98C25.543%2024.527%2015.9%2019.318%209.44%2011.396c-1.125%201.936-1.77%204.184-1.77%206.58%200%204.543%202.312%208.552%205.824%2010.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163%200%206.345%204.513%2011.638%2010.504%2012.84-1.1.298-2.256.457-3.45.457-.845%200-1.666-.078-2.464-.23%201.667%205.2%206.5%208.985%2012.23%209.09-4.482%203.51-10.13%205.605-16.26%205.605-1.055%200-2.096-.06-3.122-.184%205.794%203.717%2012.676%205.882%2020.067%205.882%2024.083%200%2037.25-19.95%2037.25-37.25%200-.565-.013-1.133-.038-1.693%202.558-1.847%204.778-4.15%206.532-6.774z%22%2F%3E%3C%2Fsvg%3E)}.twt-btn .label{margin-left:3px;white-space:nowrap;color:#fff}.twt-btn .label b{font-weight:500;white-space:nowrap}</style><a target="_blank" class="twt-btn" title="Follow @jonluca on Twitter" href="https://twitter.com/jonluca" rel="noopener noreferrer"><i></i> <span class="label">Follow @jonluca</span></a></div><style>#je93dn9s{display:inline-block;vertical-align:middle}#je93dn9s:after{content:"";display:block;clear:both}#je93dn9s>div{position:relative;text-align:left;height:36px;width:32px;float:left;text-align:center}#je93dn9s>div>svg{height:16px;fill:#d5d5d5;margin-top:10px}#je93dn9s>div:hover{cursor:pointer}#je93dn9s>div.fir:hover>svg{fill:#3b5998}#je93dn9s>div.seco:hover>svg{fill:#55acee}#je93dn9s>div.thir:hover>svg{fill:#0077b5}#je93dn9s>div.fourt:hover>svg{fill:#cb2027}#je93dn9s>div.fif:hover>svg{fill:#dd4b39}#je93dn9s>div.sixt:hover>svg{fill:#7d7d7d}#je93dn9s>div.fir>svg{height:18px;margin-top:9px}#je93dn9s>div.seco>svg{height:20px;margin-top:8px}#je93dn9s>div.thir>svg{height:19px;margin-top:7px}#je93dn9s>div.fourt>svg{height:20px;margin-top:9px}#je93dn9s>div.fif>svg{height:17px;margin-top:9px;position:relative;left:1px}#je93dn9s>div.sixt>svg{height:14px;margin-top:11px}</style><span class="gray">Share on:</span><div id="je93dn9s"><div class="fir" title="Share this on Facebook" onclick="if (!window.__cfRLUnblockHandlers) return false; window.open(`http://www.facebook.com/share.php?u=https://blog.jonlu.ca/posts/spf-dkim`);"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"></path></svg></div><div class="seco" title="Share this on Twitter" onclick="if (!window.__cfRLUnblockHandlers) return false; window.open(`https://twitter.com/intent/tweet?text=Email authentication: SPF, DKIM and DMARC out in the wild&amp;url=https://blog.jonlu.ca/posts/spf-dkim&amp;via=jonluca&amp;related=jonluca`);"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"></path></svg></div><div class="thir" title="Share this on Linkedin" onclick="if (!window.__cfRLUnblockHandlers) return false; window.open(`https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.jonlu.ca/posts/spf-dkim&amp;title=Email authentication: SPF, DKIM and DMARC out in the wild&amp;summary=&amp;source=JonLuca's Blog`);"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"></path></svg></div><div class="fif" title="Share this on Reddit" onclick="if (!window.__cfRLUnblockHandlers) return false; window.open(`http://www.reddit.com/submit?url=https://blog.jonlu.ca/posts/spf-dkim`);"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M24 11.779c0-1.459-1.192-2.645-2.657-2.645-.715 0-1.363.286-1.84.746-1.81-1.191-4.259-1.949-6.971-2.046l1.483-4.669 4.016.941-.006.058c0 1.193.975 2.163 2.174 2.163 1.198 0 2.172-.97 2.172-2.163s-.975-2.164-2.172-2.164c-.92 0-1.704.574-2.021 1.379l-4.329-1.015c-.189-.046-.381.063-.44.249l-1.654 5.207c-2.838.034-5.409.798-7.3 2.025-.474-.438-1.103-.712-1.799-.712-1.465 0-2.656 1.187-2.656 2.646 0 .97.533 1.811 1.317 2.271-.052.282-.086.567-.086.857 0 3.911 4.808 7.093 10.719 7.093s10.72-3.182 10.72-7.093c0-.274-.029-.544-.075-.81.832-.447 1.405-1.312 1.405-2.318zm-17.224 1.816c0-.868.71-1.575 1.582-1.575.872 0 1.581.707 1.581 1.575s-.709 1.574-1.581 1.574-1.582-.706-1.582-1.574zm9.061 4.669c-.797.793-2.048 1.179-3.824 1.179l-.013-.003-.013.003c-1.777 0-3.028-.386-3.824-1.179-.145-.144-.145-.379 0-.523.145-.145.381-.145.526 0 .65.647 1.729.961 3.298.961l.013.003.013-.003c1.569 0 2.648-.315 3.298-.962.145-.145.381-.144.526 0 .145.145.145.379 0 .524zm-.189-3.095c-.872 0-1.581-.706-1.581-1.574 0-.868.709-1.575 1.581-1.575s1.581.707 1.581 1.575-.709 1.574-1.581 1.574z"></path></svg></div><div class="sixt" title="Share this through Email" onclick="if (!window.__cfRLUnblockHandlers) return false; window.open(`mailto:?subject=Email authentication: SPF, DKIM and DMARC out in the wild&amp;body=https://blog.jonlu.ca/posts/spf-dkim`);"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"></path></svg></div></div></main></div><script type="text/javascript">function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-90475221-1"),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js");var _paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["setCookieDomain","*.jonlu.ca"]),_paq.push(["setDomains",["*.jonlu.ca","*.blog.jonlu.ca"]]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="//matomo.jonlu.ca/";_paq.push(["setTrackerUrl",a+"js/"]),_paq.push(["setSiteId","1"]);var e=document,t=e.createElement("script"),n=e.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.defer=!0,t.src=a+"js/",n.parentNode.insertBefore(t,n)}()</script><script async="" defer="defer" src="Email%20authentication%20%20SPF,%20DKIM%20and%20DMARC%20out%20in%20the%20wild%20-%20JonLuca's%20Blog_files/js.js" type="text/javascript"></script><script async="" defer="defer" src="Email%20authentication%20%20SPF,%20DKIM%20and%20DMARC%20out%20in%20the%20wild%20-%20JonLuca's%20Blog_files/preload.js" type="text/javascript"></script><noscript><p><img src="//matomo.jonlu.ca/matomo.php?idsite=1&rec=1"style="border:0"alt=""></p></noscript></body></html>